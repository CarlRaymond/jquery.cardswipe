/*! jQuery.CardSwipe Magnetic Stripe Card Reader - v2.0.1 - 2015-08-21
* https://github.com/CarlRaymond/jquery.cardswipe
* Copyright (c) 2015 Carl J. Raymond; Licensed GPLv2 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){a.cardswipe=function(a){if(t[a])return t[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!=typeof a&&a)throw"Method "+a+" does not exist on jQuery.cardswipe";return t.init.apply(this,arguments)};var b,c,d={generic:function(a){var b=new RegExp("^(%[^%;\\?]+\\?)?(;[0-9\\:<>\\=]+\\?)?(;[0-9\\:<>\\=]+\\?)?"),c=b.exec(a);if(!c)return null;var d={type:"generic",line1:c[1],line2:c[2],line3:c[3]};return d},visa:function(a){var b=new RegExp("^%B(4[0-9]{12,18})\\^([A-Z ]+)/([A-Z ]+)\\^([0-9]{2})([0-9]{2})"),c=b.exec(a);if(!c)return null;var d=c[1];if(!u(d))return null;var e={type:"visa",account:d,lastName:c[2].trim(),firstName:c[3].trim(),expYear:c[4],expMonth:c[5]};return e},mastercard:function(a){var b=new RegExp("^%B(5[1-5][0-9]{14})\\^([A-Z ]+)/([A-Z ]+)\\^([0-9]{2})([0-9]{2})"),c=b.exec(a);if(!c)return null;var d=c[1];if(!u(d))return null;var e={type:"mastercard",account:d,lastName:c[2],firstName:c[3],expYear:c[4],expMonth:c[5]};return e},amex:function(a){var b=new RegExp("^%B(3[4|7][0-9]{13})\\^([A-Z ]+)/([A-Z ]+)\\^([0-9]{2})([0-9]{2})"),c=b.exec(a);if(!c)return null;var d=c[1];if(!u(d))return null;var e={type:"amex",account:d,lastName:c[2],firstName:c[3],expYear:c[4],expMonth:c[5]};return e}},e={IDLE:0,PENDING:1,READING:2,DISCARD:3,PREFIX:4},f={0:"IDLE",1:"PENDING",2:"READING",3:"DISCARD",4:"PREFIX"},g=e.IDLE,h=function(){if(0==arguments.length)return g;var b=arguments[0];b!=h&&(c.debug&&console.log("%s -> %s",f[g],f[b]),b==e.READING&&a(document).trigger("scanstart.cardswipe"),g==e.READING&&a(document).trigger("scanend.cardswipe"),g=b)},i=0,j=function(d){switch(c.debug&&console.log(d.which+": "+String.fromCharCode(d.which)),h()){case e.IDLE:37==d.which&&(h(e.PENDING),b=new Array,k(d.which),d.preventDefault(),d.stopPropagation(),l()),c.prefixCode&&c.prefixCode==d.which&&(h(e.PREFIX),d.preventDefault(),d.stopPropagation(),l());break;case e.PENDING:d.which>=65&&d.which<=90?(h(e.READING),a("input").blur(),k(d.which),d.preventDefault(),d.stopPropagation(),l()):(m(),b=null,h(e.IDLE));break;case e.READING:k(d.which),l(),d.preventDefault(),d.stopPropagation(),13==d.which&&(m(),h(e.IDLE),o()),c.firstLineOnly&&63==d.which&&(h(e.DISCARD),o());break;case e.DISCARD:if(d.preventDefault(),d.stopPropagation(),13==d.which)return m(),void h(e.IDLE);l();break;case e.PREFIX:if(d.which==c.prefixCode)return void h(e.IDLE);d.preventDefault(),d.stopPropagation(),37==d.which&&(h(e.PENDING),b=new Array,k(d.which)),l()}},k=function(a){b.push(String.fromCharCode(a))},l=function(){clearTimeout(i),i=setTimeout(n,c.interdigitTimeout)},m=function(){clearTimeout(i),i=0},n=function(){c.debug&&console.log("Timeout!"),h()==e.READING&&o(),b=null,h(e.IDLE)},o=function(){c.debug&&console.log(b);for(var e=b.join(""),f=0;f<c.parsers.length;f++){var g,h=c.parsers[f];if(a.isFunction(h)?g=h:"string"==typeof h&&(g=d[h]),null!=g){var i=g.call(this,e);if(null==i)continue;return c.complete&&c.complete.call(this,i),void a(document).trigger("success.cardswipe",i)}}c.error&&c.error.call(this,e),a(document).trigger("failure.cardswipe")},p=function(){a(document).bind("keypress",j)},q=function(){a(document).unbind("keypress",j)},r=function(a){var b=["Line 1: ",a.line1,"\nLine 2: ",a.line2,"\nLine 3: ",a.line3].join("");alert(b)},s={enabled:!0,interdigitTimeout:250,complete:r,error:null,parsers:["generic"],firstLineOnly:!1,prefixCharacter:null,debug:!1},t={init:function(b){if(c=a.extend(s,b||{}),c.prefixCharacter){if(1!=c.prefixCharacter.length)throw"PrefixCharacter must be a single character";c.prefixCode=c.prefixCharacter.charCodeAt(0)}c.enabled&&t.enable()},disable:function(a){q()},enable:function(a){p()}},u=function(a){for(var b=[0,2,4,6,8,1,3,5,7,9],c=0,d=a.length,e=!0;d--;){var f=parseInt(a.charAt(d),10);c+=e?f:b[f],e=!e}return c%10==0&&c>0}});